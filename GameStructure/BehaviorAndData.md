# 行为和数据

## 作为行为和数据的游戏

“游戏是什么”是个颇难回答的问题，但限定于计算机的视角，我们可以给电子游戏一个大致的描述——游戏就是主要用于娱乐的交互性程序。

而一个程序一般来说包括行为和数据两个部分。举例来说，游戏中各种人物属性是数据，而按照设定规则计算战斗伤害和游戏胜负的过程是行为，计算出来的伤害数值和胜负结果则又是数据。行为信息保存在行为文件中，数据信息则保存在数据文件中。行为文件和数据文件合起来构成一个完整的电子游戏。

这种行为和数据的二分其实不仅仅对电子游戏起效，对大多数的桌游或其他游戏也是如此。例如卡牌游戏的卡牌牌面是数据，而出牌是行为；围棋的棋局状态是数据，而落子是行为。只不过对于电子游戏来说，行为不全是人做出的。而是有相当一部分行为由计算机做出，例如前边提到的各种伤害计算和胜负计算就是计算机代劳的。

如果要告诉一个人类玩家或者游戏主持者在游戏中应当做什么，我们只需要写一本游戏说明书或者行动顺序卡。而要告诉计算机在游戏中应该做什么，就需要写一个行为文件或者说可执行文件。所谓可执行文件其实也是文件，只不过其中保存的不是图像、文本或者人物血量之类的游戏数据，而是计算机动作的序列。也就是给计算机看的游戏说明书和行动顺序卡。

例如说你想让伤害值经过护甲衰减作用到敌方的血量上，这本身是一个计算行为。这个行为需要计算机先用伤害减去护甲，然后再用血量减去上一步所得的差。而行为文件就是对这个过程中先做什么和后做什么的描述，好像剧本指挥演员一样指挥计算机进行计算行为。

不过注意，行为文件是不能凭空定义的。一个行为文件只能是让计算机组合排列已有的基本动作（例如加减乘除），而没法凭空创造新的基本动作。

> 这里关于“行为”和“数据”的描述当然是不够严谨准确的，只是提供一个大概的印象。

## 游戏不能运行的本质

要让一款游戏可玩，其实只需要满足两个条件。一是你有它的行为和数据文件，二是这两者可以正常在你的计算机上运作起来。

复制保存一款游戏的行为文件和数据文件是一件很简单的事情，在平台上买游戏然后下载安装就是在进行这一过程。可能出问题的是让它们运行起来。

对于数据文件来说，它们需要合适的展示工具才能在计算机上展示。例如电影就是数据，你下载了一部电影却没有对应电影格式的播放软硬件的话就没法正常播放电影。如果你的计算机上没有处理游戏中形形色色的图像声音数据的展示工具，自然没法正常游戏。不过好消息是，由于“播放”这一过程本身也是一种行为，所以一般来说一款游戏的行为文件中会自带播放它的数据文件的功能。游戏的行为文件本身就会告诉计算机如何把游戏数据文件渲染成声音、画面或者文本等形式呈现出来。

而对于行为文件来说，事情就变得很复杂。因为行为文件需要直接交给计算机去执行。但正如我们之前说过的，行为文件不能凭空创造行为。它没法让计算机做到自己不能的事情。例如你没法让一个没有音箱和显示器的计算机正常播放电影。行为文件只能组合排列计算机能做到的基本动作。但不同计算机软硬件平台下，计算机可以做到的基本动作是不一样的，计算机内部对于这些动作的称呼也是不一样的。这就好像不同的计算机操着不同的语言，用法语写的剧本没法直接交给只懂英语的演员去排演。

当计算机看不懂游戏中行为文件的指示时，游戏就没法在计算机上正常执行。

## 重写或翻译

要想让一台计算机“看懂”一个它本来看不懂的行为文件，没法从计算机这边想办法。因为它能看懂什么是出场的时候就决定的。所以往往从行为文件本身上想办法。办法也很简单——重写或者翻译。

重写，就是由游戏的开发者把行为文件用一类计算机能看懂的语言重写一遍。这个办法最为彻底但是需要消耗大量的人力。

翻译则是由一个叫虚拟机的专门的软件把行为文件和真实的计算机软硬件平台隔离开。由这个虚拟机负责把行为文件翻译给真实的软硬件平台去执行。如果要类比戏剧的化，就像是给剧本配备了一个多语言的专职翻译。这样在操不同方言的演员团体排演剧本的时候，由虚拟机这个翻译把剧本翻译给他们听，不需要剧本作家本人一遍遍用不同语言重写剧本。这个办法相对来说节人力但是可能造成计算机性能上的开销——因为翻译本身也要占用计算机资源。

让一款老游戏在新电脑上运行，其实无非就是采用了这两种方法之一。要么重写了老游戏的行为文件，让它可以在新电脑上执行；要么就是让虚拟机把老电脑平台的语言翻译成新电脑平台的语言。

当然这两种方法也适用于平台之间的移植。如果你想让 Windows 上的游戏能在 Android 上运行。也只需要把它用 Android 的语言重写一遍或者用虚拟机翻译过去执行。

## 行为的数据化

不过有由于重写和翻译各有各的难处，一般来说，人们希望此类工作越简单越好。也就是需要重写或翻译的行为文件越少越好。那么有办法在保持游戏机制和效果大致不变的情况下减少行为文件数量的办法嘛？还真有，这就是行为的数据化。也就是一些本来由行为文件记录事情交给数据文件记录，然后当作数据文件处理。

这又分两种情况。第一种情况是通过设计让行为中的数据分离出来。例如游戏中的剧情对话。如果你把“说‘你好’”理解为一个动作，那么它就需要写在行为文件中。但如果你把“说”理解为动作，说的内容“你好”理解为行为，那么就仅仅需要把“说”这个动作写在行为文件中，说的内容“你好”就可以写在数据文件中。这样就能让游戏中的对话文本和行为文件分离，不仅减小了行为文件的体积，而且方便了以后做一些文本修改或者翻译工作。

第二种则是在游戏的行为中内置一个虚拟机。只不过这个虚拟机的作用不是把游戏的行为文件翻译给原本不支持的计算机平台，而是把游戏的一些被称为“脚本”（也就是剧本）的数据文件翻译成它所支持的计算机平台上的行为指令。经过这一层翻译，原本写在行为文件中的很多内容就可以写成脚本数据文件，像其他数据文件那样轻松处理。脚本数据文件虽然记录了很多行为，但由于它需要经过虚拟机翻译执行，所以对于翻译它的虚拟机来说，它就是数据文件。虽然这样做会像其他虚拟机那样造成一些额外的计算集资源开销，但它确实能减小真正的行为文件的体积。同时，由于脚本文件算数据，所以它往往还比真正的行为文件更容易修改和替换，具有更多的灵活性。

可能你会担心游戏内置虚拟机的做法可能让游戏很慢。确实有这种可能，但是一般来说游戏自身内置的虚拟机都会经过特别优化，相比 Android 上模拟 Windows 之类的通用虚拟机要快很多。另外就是，当设计者觉得一些功能放到虚拟机中运行太慢时，他还可以选择把这些功能写回到真正的行为文件中。总之在实践中，内置一个虚拟机的做法看似有点离谱，实则是一个很有效的办法。

此外，以上两种行为数据化的方法还可以综合使用，以大大减小游戏行为文件的数量和体积。以大家熟悉的《帝国时代》为例，游戏中的地图文件被作为数据文件从行为文件中分离出来。所以玩家才能像复制音乐文件一样去复制游戏地图。而更为古早的一些游戏则不一定做了这种分离，所以无法替换或这更改地图。

同时，对于游戏战役中的一些剧情表现、任务目标和任务奖励等，《帝国时代》采用一种在游戏内被称为触发器的脚本来描述。这一方面把游戏剧情战役的内容从游戏行为文件中彻底分离出来，另一方面也让玩家可以在不改变游戏行为文件的情况下修改原有战役或者自制扩展战。
